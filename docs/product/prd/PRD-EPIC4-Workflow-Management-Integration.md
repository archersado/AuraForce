# Epic 4 - Workflow Management Integration PRD

**版本:** v1.0
**创建日期:** 2025-02-02
**最后更新:** 2025-02-02
**负责人:** Product Designer
**状态:** ✅ 设计完成

---

## 1. 产品概述

### 1.1 产品描述
Epic 4 - Workflow Management Integration 旨在将 Workflow 管理功能无缝集成到 AuraForce 主流程中，提供统一的用户体验和视觉风格，让用户可以在工作区和 Claude Code 对话之间平滑地管理、发现和使用工作流。

### 1.2 产品目标
1. **流程集成:** 将 Workflow 管理与主用户流程（Workspace → Claude Code）有机融合
2. **设计统一:** 确保 Workflow 相关页面与主应用保持一致的视觉风格
3. **体验优化:** 提供直观的工作流发现、加载和使用体验
4. **功能完善:** 支持工作流跨用户共享、版本管理、快速加载到 Workspace

### 1.3 目标用户
- **用户画像 1 - 开发者 Alex:**
  - 需要频繁使用不同的工作流
  - 期望快速切换和测试工作流
  - 希望发现其他开发者分享的有用工作流

- **用户画像 2 - 团队协作者 Sarah:**
  - 需要与团队成员共享工作流
  - 关注工作流版本和更新
  - 期望在项目间快速复用工作流

- **用户画像 3 - 新手用户 Mike:**
  - 不熟悉 BMAD 工作流
  - 需要简单的工作流发现和学习路径
  - 期望有示例和模板工作流

---

## 2. 市场分析

### 2.1 市场背景
当前的 Workflow 管理功能相对独立，用户需要在单独的页面进行工作流上传、管理和加载，然后跳转到 Workspace 或 Claude Code 使用。这种割裂的体验降低了工具的易用性和效率。

### 2.2 竞品分析
| 特性 | AuraForce 当前 | 理想状态 |
|------|---------------|----------|
| 工作流发现 | 需要访问独立页面 | 集成到 Workspace 和 Claude |
| 视觉一致性 | 差异较大 | 统一的设计规范 |
| 用户流程 | 分割的多步骤 | 平滑的连续流程 |
| 跨用户共享 | 基础支持 | 完善的工作流市场 |

### 2.3 竞争优势
- **一体化体验:** 工作流管理与 AI 对话无缝衔接
- **视觉一致性:** 遵循统一的设计系统
- **社交化:** 工作流共享和发现机制
- **灵活性:** 既可通过 UI 操作，也可以通过 API 编程

---

## 3. 用户需求

### 3.1 用户故事

| ID | 用户故事 | 优先级 |
|----|---------|--------|
| EPIC4-USR-001 | 作为开发者，我想要在 Workspace 中直接浏览和选择工作流模板，以便快速开始新项目 | P0 |
| EPIC4-USR-002 | 作为开发者，我想要在 Claude 对话中快速加载和使用工作流，以便提高开发效率 | P0 |
| EPIC4-USR-003 | 作为团队成员，我想要分享工作流给团队，以便协作和知识沉淀 | P1 |
| EPIC4-USR-004 | 作为新用户，我想要浏览和探索公开的工作流，以便学习和使用最佳实践 | P1 |
| EPIC4-USR-005 | 作为用户，我想要查看工作流详细信息（元数据、依赖、子 Agent 等），以便了解工作流的功能 | P1 |
| EPIC4-USR-006 | 作为用户，我想要设置工作流的可见性（公开/私有），以便控制访问权限 | P0 |
| EPIC4-USR-007 | 作为用户，我想要搜索和筛选工作流，以便快速找到需要的工作流 | P1 |
| EPIC4-USR-008 | 作为用户，我想要查看工作流的使用统计（加载次数、收藏数），以便评估工作流的受欢迎程度 | P2 |

### 3.2 需求分析

#### 核心需求
1. **无缝集成:** Workflow 管理功能应该融入现有的用户流程，而不是孤立存在
2. **设计一致性:** 所有 Workflow 相关页面应使用统一的组件、颜色和交互模式
3. **上下文感知:** 在 Workspace 和 Claude 中显示相关的工作流建议
4. **跨设备一致性:** 在桌面和移动端保持一致的用户体验

#### 功能需求
1. **Workflow Marketplace:** 专门的浏览和探索工作流的页面
2. **快速加载:** 在 Workspace 和 Claude 中一键加载工作流
3. **工作流详情:** 显示完整的工作流元信息
4. **可视化设计:** 使用图标、徽章和视觉元素提高可读性

---

## 4. 功能需求

### 4.1 核心功能矩阵

| 功能 | 描述 | 优先级 | 状态 |
|------|------|--------|------|
| 工作流集成到 Workspace | 在 Workspace 中显示工作流模板选择器 | P0 | 设计中 |
| 工作流集成到 Claude | 在 Claude 对话中提供工作流加载入口 | P0 | 设计中 |
| 工作流市场 2.0 | 重新设计的公开工作流浏览页面 | P1 | 设计中 |
| 统一设计系统 | 应用全局设计规范到所有 Workflow 页面 | P0 | 设计中 |
| 工作流详情优化 | 改进工作流详情页的信息展示 | P1 | 计划中 |
| 工作流搜索优化 | 增强搜索和筛选功能 | P1 | 计划中 |

### 4.2 功能详细描述

#### 4.2.1 Workflow 在 Workspace 中的集成

**描述：** 在 Workspace 页面中直接集成工作流模板选择，用户可以在创建项目时选择工作流模板。

**用户流程：**
```
用户访问 Workspace
    ↓
点击 "New Project"
    ↓
看到工作流模板列表（推荐模板 + 我的模板 + 公开模板）
    ↓
选择工作流模板
    ↓
输入项目名称和描述
    ↓
创建项目并加载工作流
```

**接受标准：**
- [ ] Workspace 页面显示工作流模板选择 UI
- [ ] 工作流模板按类别分组（推荐、我的、公开）
- [ ] 每个工作流显示缩略图、名称、描述、作者
- [ ] 选择工作流后预览其元数据
- [ ] 创建项目时自动部署选中的工作流

#### 4.2.2 Workflow 在 Claude 中的集成

**描述：** 在 Claude Code 对话界面中提供快速加载工作流的入口，支持通过命令或按钮加载。

**用户流程：**
```
用户在 Claude 对话中
    ↓
点击工具栏 "Workflows" 按钮或输入 /workflow 命令
    ↓
弹出工作流选择面板
    ↓
搜索或浏览工作流
    ↓
选择工作流
    ↓
工作流部署并出现在 Workspace
    ↓
Claude 通知工作流已就绪
```

**接受标准：**
- [ ] Claude 界面有工作流工具栏按钮
- [ ] 支持 /workflow 命令弹出工作流选择器
- [ ] 工作流选择器显示可用的工作流列表
- [ ] 加载工作流后显示进度通知
- [ ] 加载完成后 Claude 确认工作流已就绪

#### 4.2.3 统一设计系统应用

**描述：** 将 Workflow 页面的样式与主应用统一，包括颜色、字体、间距、组件样式。

**设计规范：**
- **颜色方案：**
  - 主色：紫色系（用于交互元素）
  - 成功色：绿色系（状态、徽章）
  - 警告色：黄色系
  - 错误色：红色系
  - 背景：采用渐变背景（白色 → 紫色）

- **组件样式：**
  - 按钮：圆角、带图标、悬停效果
  - 卡片：圆角、阴影、边框
  - 徽章：小尺寸、带图标
  - 输入框：圆角、聚焦紫色边框

- **布局：**
  - 最大宽度：max-w-5xl / max-w-7xl
  - 间距：space-y-4 / space-y-6
  - 内边距：py-8 px-4
  - 响应式：sm:flex-row、md:grid-cols-* 等

**接受标准：**
- [ ] 所有 Workflow 页面使用统一的设计 Token
- [ ] 颜色与主应用一致（紫色主题）
- [ ] 按钮样式与主应用一致
- [ ] 卡片样式与主应用一致
- [ ] 响应式布局与主应用一致

#### 4.2.4 工作流市场 2.0

**描述：** 重新设计的工作流市场页面，提供更好的浏览、搜索和发现体验。

**页面布局：**
```
[标题: 工作流市场]
[搜索框 + 筛选器]
[分类标签: 全部 | 推荐 | 最新 | 热门]
[工作流卡片网格]
  [卡片 1] [卡片 2] [卡片 3]
  [卡片 4] [卡片 5] [卡片 6]
[分页控件]
```

**功能特性：**
- 搜索工作流（名称、描述、标签）
- 按分类筛选（全部、推荐、最新、热门）
- 显示工作流统计信息（加载次数、收藏数）
- 工作流预览（元数据、依赖）
- 一键加载到 Workspace
- 工作流收藏功能

**接受标准：**
- [ ] 页面使用网格布局展示工作流
- [ ] 支持搜索和分类筛选
- [ ] 每个工作流卡片显示完整信息
- [ ] 可以快速加载工作流
- [ ] 可以收藏/取消收藏工作流
- [ ] 页面样式与主应用一致

---

## 5. 非功能需求

### 5.1 性能需求
- 工作流列表加载时间: < 1 秒
- 工作流详情加载时间: < 500ms
- 搜索响应时间: < 300ms
- 支持分页，每页 20 个工作流

### 5.2 安全需求
- 私有工作流仅对创建者可见
- 公开工作流可以被所有用户查看和加载
- API 请求验证用户身份和权限
- 防止恶意工作流上传和执行

### 5.3 兼容性需求
- 浏览器: Chrome, Firefox, Safari, Edge（最新版本）
- 移动端: 响应式设计，支持平板设备
- 深色模式: 完整支持 dark mode

### 5.4 可访问性需求
- 键盘导航支持
- 屏幕阅读器友好（ARIA 标签）
- 色彩对比度符合 WCAG AA 标准
- 焦点可见性

---

## 6. 数据需求

### 6.1 数据模型

```typescript
interface WorkflowSpec {
  id: string;
  name: string;
  description?: string;
  version?: string;
  author?: string;
  ccPath: string;
  status: 'deployed' | 'error' | 'pending';
  visibility: 'public' | 'private';  // 已实现
  metadata?: {
    tags?: string[];
    requires?: string[];
    resources?: Array<{ path: string; description?: string }>;
    agents?: Array<{ name: string; path: string }>;
    subWorkflows?: Array<{ name: string; path: string }>;
  };
  stats?: {  // 新增：统计信息
    loads: number;        // 加载次数
    favorites: number;    // 收藏数
    rating: number;       // 评分（1-5）
    ratingCount: number;  // 评分人数
  };
  deployedAt: Date;
  updatedAt: Date;
}

interface WorkflowFavorite {  // 新增：收藏关系
  id: string;
  userId: string;
  workflowId: string;
  createdAt: Date;
}
```

### 6.2 API 需求

| 端点 | 方法 | 描述 |
|------|------|------|
| `/api/workflows` | GET | 获取工作流列表（含 visibility 支持） |
| `/api/workflows/advanced` | GET | 高级搜索工作流 |
| `/api/workflows/popular` | GET | 获取热门工作流（新增） |
| `/api/workflows/featured` | GET | 获取推荐工作流（新增） |
| `/api/workflows/[id]` | GET | 获取工作流详情 |
| `/api/workflows/[id]` | PATCH | 更新工作流（含 visibility） |
| `/api/workflows/[id]` | DELETE | 删除工作流 |
| `/api/workflows/load-template` | POST | 加载工作流模板 |
| `/api/workflows/[id]/favorite` | POST | 收藏/取消收藏工作流（新增） |
| `/api/workflows/[id]/stats` | GET | 获取工作流统计信息（新增） |

### 6.3 数据存储
- **WorkflowSpec 表：** 已存在，需添加 `stats` 字段
- **WorkflowFavorite 表：** 新增，存储用户收藏关系
- **索引：** `visibility` 索引（已实现），`stats.loads` 索引（新增）

---

## 7. 用户体验

### 7.1 完整用户流程

```
[新用户注册]
    ↓
1. 进入 Workspace，看到欢迎页面和快速操作卡片
    ↓
2. 点击 "New Project"，选择工作流模板
    │
    ├─ 推荐 模板（根据用户推荐）
    ├─ 我的模板（用户创建/收藏的）
    └─ 公开模板（工作流市场）
    ↓
3. 选择工作流，预览信息
    ↓
4. 创建项目，工作流自动部署
    ↓
5. 进入 Claude Code，开始对话
    ↓
6. 需要切换工作流时：
    - 点击工具栏 "Workflows" 按钮
    - 或输入 "/workflow" 命令
    - 选择新工作流
    - 确认部署
    ↓
7. 继续使用新工作流进行对话
    ↓
8. 可选：访问 "工作流市场" 发现更多工作流
    - 浏览热门工作流
    - 搜索特定功能的工作流
    - 收藏喜欢的工作流
```

### 7.2 页面导航结构

```
AuraForce
├── [主页/登录]
├── [Workspace]
│   ├── 欢迎页面
│   │   ├── 快速操作卡片（New Project, Upload Workflow, 技能提取）
│   │   └── 我的项目列表
│   ├── 创建项目（选择工作流模板）[新页面]
│   └── 项目详情页
├── [Claude Code]
│   ├── 对话界面
│   │   ├── 工具栏（含 "Workflows" 按钮）
│   │   ├── 消息列表
│   │   └── 输入区域
│   └── 工作流选择器面板 [新侧边栏/模态框]
├── [工作流管理]
│   ├── 已部署工作流
│   ├── 上传新工作流
│   └── 工作流详情
└── [工作流市场] [重新设计]
    ├── 搜索和筛选
    ├── 分类浏览
    ├── 工作流卡片网格
    └── 工作流详情预览
```

### 7.3 交互设计

#### 交互模式 1: 在 Workspace 创建项目
```
1. 点击 "New Project" 按钮
2. 弹出创建项目对话框（或导航到创建页面）
3. 左侧：工作流模板分类导航
   - 推荐项目
   - 我的工作流
   - 公开市场
4. 右侧：工作流卡片列表
   - 搜索框
   - 卡片网格布局（3列桌面，2列平板，1列手机）
   - 每张卡片：缩略图、名称、描述、作者、标签
5. 选择工作流卡片
6. 右侧面板显示工作流详情预览
7. 输入项目名称和描述
8. 点击 "创建项目" 按钮
9. 成功提示，跳转到项目详情页
```

#### 交互模式 2: 在 Claude 加载工作流
```
方式 A: 工具栏按钮
1. 点击工具栏 "Workflows" 按钮（FolderOpen 图标）
2. 右侧滑出工作流选择面板（280px 宽度）
3. 显示搜索框、筛选器、工作流列表
4. 选择工作流卡片
5. 点击 "加载" 按钮
6. 显示加载进度
7. 加载完成后通知并在对话中确认

方式 B: 命令输入
1. 在消息输入框输入 "/workflow"
2. 弹出命令面板（居中模态框）
3. 显示可用的工作流
4. 选择工作流
5. 自动加载

方式 C: 上下文建议
1. 用户提到 "workflow" 或 "模板"
2. Claude 自动建议相关工作流
3. 用户点击建议直接加载
```

### 7.4 错误处理

| 场景 | 错误消息 | 处理方式 |
|------|----------|----------|
| 工作流加载失败 | "无法加载工作流" | 显示重试按钮，提供错误详情 |
| 工作流格式错误 | "工作流格式无效" | 提示用户检查文件格式 |
| 权限不足 | "无权访问此工作流" | 提示联系工作流创建者 |
| 网络错误 | "网络连接失败" | 显示重试按钮，自动重试 3 次 |
| 工作流部署超时 | "部署超时，请稍后重试" | 提供查看部署状态链接 |

---

## 8. 产品路线图

| 阶段 | 时间 | 功能 |
|------|------|------|
| **Phase 1 - 核心集成** | Sprint 2 | 工作流在 Workspace 和 Claude 中的集成 |
| **Phase 2 - 设计统一** | Sprint 2 | 统一所有 Workflow 页面的设计样式 |
| **Phase 3 - 体验优化** | Sprint 3 | 工作流市场 2.0、搜索优化、统计功能 |
| **Phase 4 - 社交化** | Sprint 4 | 工作流评分、评论、Fork 功能 |

---

## 9. 成功指标

| 指标 | 目标 | 测量方式 |
|------|------|----------|
| 工作流发现率 | 提升 50% | 工作流市场访问次数 / 总用户数 |
| 工作流加载时间 | < 3 秒 | 从点击到加载完成的平均时间 |
| 工作流使用率 | 提升 30% | 使用工作流的项目数 / 总项目数 |
| 工作流共享率 | 提升 100% | 公开工作流数 / 总工作流数 |
| 用户满意度 | NPS > 40 | 用户调研反馈 |

---

## 10. 风险和挑战

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| 设计统一困难 | 高 | 中 | 建立完整的设计系统，提供组件库 |
| 工作流兼容性问题 | 中 | 中 | 提供工作流验证工具，格式检查 |
| 性能问题（大量工作流） | 中 | 中 | 实现分页、懒加载、缓存策略 |
| 用户习惯改变 | 中 | 中 | 引导教程、帮助文档、渐进式引入 |
| 安全风险（恶意工作流） | 高 | 低 | 工作流审核机制、沙箱执行 |

---

## 11. 验收标准

### Phase 1 验收
- [ ] Workspace 中可以选择工作流模板创建项目
- [ ] Claude 中可以通过按钮或命令加载工作流
- [ ] 工作流加载后正常部署和运行
- [ ] 工作流 visibility 功能正常工作

### Phase 2 验收
- [ ] 所有 Workflow 页面使用统一的设计规范
- [ ] 颜色、字体、组件样式与主应用一致
- [ ] 响应式布局在桌面、平板、手机上正常显示
- [ ] 深色模式支持

### Phase 3 验收
- [ ] 工作流市场页面重新设计并上线
- [ ] 搜索和筛选功能正常
- [ ] 工作流统计信息显示
- [ ] 工作流收藏功能

---

## 12. 相关文档

- **设计文档:** `docs/product/design/epic-4-workflow-management-ui-design.md`
- **设计规范:** `docs/product/design/code-editor-ui-design.md`
- **主流程设计:** Sprint 1 设计文档
- **API 文档:** API 端点定义
- **数据库 Schema:** `prisma/schema.prisma`

---

## 13. 变更历史

| 版本 | 日期 | 变更内容 | 负责人 |
|------|------|----------|--------|
| v1.0 | 2025-02-02 | 初始版本 - Epic 4 完整 PRD | Product Designer |

---

**PRD 状态:** ✅ 设计完成，待评审
**下一步:** UI/UX 设计评审，开发任务拆解
