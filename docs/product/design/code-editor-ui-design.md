# Code Editor UI 设计文档

**Story:** STORY-14-2 (Code Editor with Syntax Highlighting)
**Epic:** EPIC-14 (Workspace Editor & File Management)
**Sprint:** Sprint 1
**设计日期:** 2025-02-02
**设计师:** Product Designer
**预计时间:** 1-2 小时
**优先级:** P1

---

## 🎯 设计目标

创建一个现代化、易用且功能丰富的代码编辑器界面，支持 20+ 编程语言的语法高亮、自动补全和多种编辑功能。设计目标是提供类似 VS Code 的专业编辑体验，同时保持界面的简洁和性能优化。

---

## 📐 编辑器布局设计

### 整体布局结构

```
┌─────────────────────────────────────────────────────────────────┐
│  [Logo]  AuraForce  Workspace                [User Profile]    │
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────┬──────────────────────────────────────────────────┐ │
│ │         │  File  Edit  View  Run  Tools  Help               │ │
│ │  File   ├──────────────────────────────────────────────────┤ │
│ │  Tree   │ ┌────────────────────────────────────────────┐  │ │
│ │         │ │  1│ import React, { useState } from 'rea│  │ │
│ │ 📁 src/ │ │  2│                                       │  │ │
│ │ 📄 app. │ │  3│ function App() {                      │  │ │
│ │   tsx   │ │  4│   const [count, setCount] = useStat│  │ │
│ │ 📄 comp.│ │  5│                                       │  │ │
│ │   onent.│ │  6│   return (                            │  │ │
│ │   tsx   │ │  7│     <div>                            │  │ │
│ │ 📄 utils│ │  8│       <button onClick={() => setCou│  │ │
│ │   .ts   │ │  9│       count++                          │  │ │
│ │         │ │ 10│       >Count is {count}               │  │ │
│ │ ────────│ │ 11│       </button>                       │  │ │
│ │ New     │ │ 12│     </div>                           │  │ │
│ │ File    │ │ 13│   )                                  │  │ │
│ │         │ │ 14│ }                                    │  │ │
│ └─────────┤ │                                          │  │ │
│           │ └────────────────────────────────────────────┘  │ │
│           │                                                  │ │
│           │ [▶ Run] [💾 Save] [⚙️ Settings]  [✔ No Errors]  │ │
│           └──────────────────────────────────────────────────┘ │
│                                                                  │
│ Terminal / Output Panel (可展开/折叠)                            │
└─────────────────────────────────────────────────────────────────┘
```

### 布局尺寸规范

#### 编辑区域 (中心)
- **最小宽度:** 800px
- **推荐宽度:** 1200px - 1600px
- **最大宽度:** 100% (适应屏幕)

#### 文件树 (左侧)
- **关闭状态:** 48px (图标模式)
- **展开状态:** 250px - 300px
- **可调节:** 支持拖拽调整宽度 (200px - 500px)

#### 行号区域
- **宽度:** 50px
- **对齐:** 右对齐
- **内边距:** 8px (右侧)
- **背景色:** `#1e1e1e` (One Dark 主题)

#### 底部状态栏
- **高度:** 24px
- **字体大小:** 12px
- **背景色:** `#007acc` (vscode blue)

### 工具栏设计

#### 顶部工具栏
**位置:** 编辑器顶部，文件标题下方
**高度:** 40px
**背景色:** `#252526` (vscode gray)

**按钮布局 (左到右):**

| 图标 | 功能 | 快捷键 | 状态 |
|------|------|--------|------|
| ⚙️ | 打开设置 | Ctrl+, | 始终可用 |
| 🔍 | 查找 | Ctrl+F | 始终可用 |
| 🔃 | 替换 | Ctrl+H | 始终可用 |
| 📄 | 格式化文档 | Shift+Alt+F | 始终可用 |
| 🔗 | 转到定义 | F12 | 选中时可用 |
| 📍 | 查找引用 | Shift+F12 | 选中时可用 |
| ▶️ | 运行代码 | F5 | 可运行语言时可用 |

**按钮样式:**
- 尺寸: 32 × 32px
- 圆角: 4px
- 悬停: `rgba(255, 255, 255, 0.1)`
- 点击: `rgba(255, 255, 255, 0.2)`
- 禁用: `opacity: 0.5`

#### 文件操作按钮 (右上角)
**位置:** 编辑器右上角，文件标题旁边

| 图标 | 功能 | 快捷键 | 位置 |
|------|------|--------|------|
| 💾 | 保存文件 | Ctrl+S | 右上角 |
| ↪️ | 另存为 | Ctrl+Shift+S | 下拉菜单 |
| ❌ | 关闭标签页 | Ctrl+W | 标签页 |

### 自动调整编辑区域
- **拖拽边框:** 文件树和编辑器之间、编辑器和终端之间
- **光标样式:** `col-resize` (水平拖拽)
- **拖拽反馈:** 显示宽/高度像素值
- **最小尺寸:** 文件树 200px, 终端 100px, 编辑器 400px
- **用户偏好:** 保存到 localStorage

---

## 🎨 语法高亮配色方案

### 默认主题: One Dark Pro

选择理由: One Dark Pro 是最受欢迎的 VS Code 主题之一，有良好的对比度和可读性，长期编码不疲劳。

### 配色方案

#### 背景色
```
编辑器背景: #1e1e1e
行号背景: #1e1e1e
侧边栏背景: #252526
活动行背景: #2c313c
选中背景: #264f78
光标背景: #aeafad
```

#### 语法元素颜色

| 语法元素 | HEX | 用途 |
|---------|-----|------|
| 关键字 | `#c678dd` | `const`, `function`, `return`, `if`, `else` |
| 字符串 | `#98c379` | `"hello"`, `'world'` |
| 数字 | `#d19a66` | `123`, `3.14`, `0xFF` |
| 注释 | `#5c6370` | `// comment`, `/* block */` |
| 函数名 | `#61afef` | `myFunction()`, `console.log` |
| 变量 | `#e06c75` | `const name = "..."` |
| CSS 类名 | `#e5c07b` | `.my-class`, `div.className` |
| 标签名 | `#e06c75` | `<div>`, `<span>`, `<button>` |
| 属性名 | `#d19a66` | `href`, `className`, `onClick` |
| 操作符 | `#56b6c2` | `+`, `-`, `=`, `===`, `&&`, `\|\|` |
| 正则表达式 | `#e5c07b` | `/regex/g` |
| 类型 | `#e5c07b` | `string`, `number`, `boolean`, `interface` |

### 主题切换支持

**提供 3 个内置主题:**

1. **One Dark Pro** (默认)
   - 深色系，高对比度
   - 适合长时间编码

2. **Monokai**
   - 经典深色主题
   - 带有紫色和绿色点缀

3. **Solarized Light**
   - 浅色主题
   - 适合明亮环境

**主题切换位置:**
- 设置 → 外观 → 主题选择
- 快捷键: `Ctrl+K, Ctrl+T`

### 对比度要求
- 最小对比度: 4.5:1 (WCAG AA)
- 优选对比度: 7:1 (WCAG AAA)
- 可读性验证: 使用色彩对比度检查工具

---

## 🧩 自动补全弹窗设计

### 弹窗位置和尺寸

**位置:** 光标下方，如果空间不足则显示在上方
**尺寸:**
- 最小宽度: 280px
- 最大宽度: 450px
- 最大高度: 300px
- 单项高度: 36px
- 间距: 4px

### 弹窗样式

```css
背景色: #252526
边框: 1px solid #454545
圆角: 4px
阴影: 0 4px 12px rgba(0, 0, 0, 0.5)
z-index: 1000
```

### 补全项设计

**普通项:**
```
┌─────────────────────────────────────┐
│ 🔵 import  React from 'react'     │ ← 类型图标 + 补全文本 + 详情
│                       ↵ Ctrl+Enter │
├─────────────────────────────────────┤
│ 🟡 useState                         │
│           React Hook                │
├─────────────────────────────────────┤
│ 🔵 useEffect                       │
│           React Hook                │
└─────────────────────────────────────┘
```

**选中项:**
- 背景色: `#094771` (vscode selection blue)
- 左边框: 2px solid `#007acc`

**类型图标:**

| 图标 | 用途 |
|------|------|
| 🔵 | 对象/模块 |
| 🟡 | 函数/方法 |
| 🟢 | 变量/常量 |
| 🔴 | 关键字 |
| ⚪ | 字符串/数字 |
| 🔷 | 类型/接口 |

### 快捷键提示

**弹窗底部提示区:**
```
┌─────────────────────────────────┐
│         Ctrl+Space to close     │ ← 快捷键提示
└─────────────────────────────────┘
```

**支持的快捷键:**
- `↑↓`: 导航选项
- `Enter`: 确认选择
- `Esc`: 关闭弹窗
- `Ctrl+Space`: 强制触发
- `Tab`: 插入并继续编辑
- `Ctrl+Enter`: 确认并换行

### 滚动样式

**当选项超过 8 项时出现滚动条:**

```css
滚动条宽度: 8px
滚动条背景: rgba(255, 255, 255, 0.1)
滚动条滑块: rgba(255, 255, 255, 0.3)
滚动条滑块悬停: rgba(255, 255, 255, 0.5)
```

**滚动行为:**
- 平滑滚动
- 选项自动进入视野
- 选中项保持在视图中央

### 详情面板 (可选展开)

**展开后显示:**
```css
宽度: 增加 150px (总宽度 600px)
分隔线: 1px solid #454545
背景色: #2d2d2d
内容: 文档字符串、类型签名、参数列表
```

---

## 📁 文件操作按钮设计

### 文件标签页设计

**标签页位置:** 编辑器顶部

**样式:**
```
┌─────────────────────────────────────────────────────────────┐
│ 📄 app.tsx  ×  │  📄 component.tsx  ×  │  📄 utils.ts  × │
│ ^^^^^^^^^^^^     ^^^^^^^^^^^^^^^^        ^^^^^^^^^^^^
│ 活动标签          非活动标签                非活动标签
└─────────────────────────────────────────────────────────────┘
```

**活动标签:**
- 背景色: `#1e1e1e`
- 边框底部: 1px solid `#007acc`
- 字体颜色: `#ffffff`
- 字体加粗: 是

**非活动标签:**
- 背景色: `#2d2d2d`
- 边框底部: 1px solid transparent
- 字体颜色: `#cccccc`
- 字体加粗: 否

**修改未保存:**
- 文件名后显示 `•` 圆点
- 圆点颜色: `#e5c07b` (警告黄)

### 头部操作按钮组

**位置:** 每个标签页的右侧

**按钮顺序 (左到右):**

| 图标 | 功能 | 悬停提示 | 快捷键 |
|------|------|----------|--------|
| 💾 | 保存文件 | 保存 (Ctrl+S) | Ctrl+S |
| ↪️ | 另存为 | 另存为 (Ctrl+Shift+S) | Ctrl+Shift+S |
| 🔓 | 权限设置 | 设置文件权限 | - |
| ❌ | 关闭标签 | 关闭标签页 (Ctrl+W) | Ctrl+W |

**按钮样式:**
- 尺寸: 28 × 28px
- 圆角: 4px
- 间距: 4px
- 半透明背景: `rgba(255, 255, 255, 0.05)`
- 悬停: `rgba(255, 255, 255, 0.1)`

### 保存按钮设计

**默认状态:**
```
[💾]  灰色图标，表示未修改
```

**修改未保存:**
```
[💾]  黄色图标 + 闪烁效果
      悬停提示: "有未保存的修改"
```

**保存中:**
```
[⏳]  加载动画
      禁用点击，悬停提示: "保存中..."
```

**保存成功:**
```
[✅]  绿色对勾图标，显示 2 秒
      然后恢复保存按钮
```

**保存失败:**
```
[❌]  红色错误图标
      持续显示直到用户关闭
      悬停提示: "保存失败: [错误信息]"
```

### 另存为弹窗

**弹窗尺寸:**
- 宽度: 500px
- 高度: 400px
- 居中显示

**内容布局:**
```
┌─────────────────────────────────────┐
│ 另存为                              × │
├─────────────────────────────────────┤
│ 文件名:                             │
│ ┌─────────────────────────────────┐ │
│ │ app-copy.tsx                   │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 保存位置:                           │
│ 📁 src/                          │ │
│   📁 components/                  │ │
│   📄 utils.ts                     │ │
│                                     │
│ 文件类型:                           │
│ ┌─────────────────────────────────┐ │
│ │ TypeScript (.tsx)               │ │
│ │ JavaScript (.js)                │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│          [取消]    [保存]           │
└─────────────────────────────────────┘
```

### 操作反馈设计

#### Toast 通知

**位置:** 右下角，垂直堆叠
**尺寸:** 宽度 320px, 自动高度

**成功 Toast:**
```
┌─────────────────────────────────────┐
│  ✅  文件已保存                     │
│      app.tsx 已成功保存             │
│      2 秒后自动关闭                  │
└─────────────────────────────────────┘
```
- 背景色: `#2e7d32` (成功绿)
- 边框: 1px solid `#4caf50`
- 图标: ✓ 对勾

**警告 Toast:**
```
┌─────────────────────────────────────┐
│  ⚠️  文件未保存                     │
│      关闭前请先保存修改              │
│      [保存] [忽略]                   │
└─────────────────────────────────────┘
```
- 背景色: `#f57c00` (警告橙)
- 边框: 1px solid `#ff9800`
- 图标: ⚠️ 警告

**错误 Toast:**
```
┌─────────────────────────────────────┐
│  ❌  保存失败                       │
│      权限不足，无法写入文件          │
│      [重试] [忽略]                   │
└─────────────────────────────────────┘
```
- 背景色: `#c62828` (错误红)
- 边框: 1px solid `#f44336`
- 图标: ✖️ 错误

**Toast 动画:**
- 进入: 从右侧滑入 (300ms)
- 关闭: 向右滑出 (300ms)
- 堆叠: 最多显示 3 个，超过则自动关闭最早的
- 手动关闭: 点击 × 按钮

#### 内联反馈

**状态栏提示:**
```
┌──────────────────────────────────────────────────────┐
│  Ln 10, Col 23  UTF-8  TypeScript  ⚙️                 │
│  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^               │
│  ↑ 保存成功! (显示 3 秒)                              │
└──────────────────────────────────────────────────────┘
```

---

## 🎭 交互设计

### 快捷键映射

| 功能 | 快捷键 | 说明 |
|------|--------|------|
| 保存 | `Ctrl+S` / `Cmd+S` | 保存当前文件 |
| 另存为 | `Ctrl+Shift+S` / `Cmd+Shift+S` | 打开另存为弹窗 |
| 关闭标签 | `Ctrl+W` / `Cmd+W` | 关闭当前标签页 |
| 关闭全部 | `Ctrl+K Ctrl+W` | 关闭所有标签页 |
| 关闭其他 | `Ctrl+K Ctrl+H` | 关闭其他标签页 |
| 自动补全 | `Ctrl+Space` | 触发自动补全 |
| 多光标 | `Alt+Click` | 添加多光标 |
| 查找 | `Ctrl+F` | 打开查找框 |
| 替换 | `Ctrl+H` | 打开替换框 |
| 格式化 | `Shift+Alt+F` | 格式化文档 |
| 转到行 | `Ctrl+G` | 跳转到指定行 |
| 撤销 | `Ctrl+Z` | 撤销操作 |
| 重做 | `Ctrl+Y` | 重做操作 |

### 鼠标交互

**编辑区域:**
- 单击: 设置光标位置
- 双击: 选择单词
- 三击: 选择整行
- 四击+拖拽: 选择多列
- 右键: 上下文菜单

**行号区域:**
- 单击: 选中整行
- 拖拽: 选中多行
- 双击: 折叠/展开代码块
- 右键: 行号上下文菜单

**标签页交互:**
- 单击: 切换标签页
- 中键点击: 关闭标签页
- 拖拽: 调整标签页顺序
- 拖拽到新窗口: 启用多窗口编辑

### 加载状态

**文件加载:**
```
┌──────────────────────────────────────┐
│  app.tsx  ×                         │
│                                      │
│  ⏳  正在加载文件...                  │
│                                      │
│  ████████████░░░░ 60%               │
└──────────────────────────────────────┘
```

- 显示骨架屏 (灰色占位)
- 进度条 (文件 > 100KB 时)
- 加载超时 (5 秒) : 显示错误提示

---

## 📱 响应式设计

### 断点定义

| 设备类型 | 屏幕宽度 | 布局调整 |
|---------|---------|---------|
| 桌面 (Desktop) | > 1200px | 完整布局 |
| 平板 (Tablet) | 768px - 1200px | 可折叠侧边栏 |
| 手机 (Mobile) | < 768px | 全屏编辑器 |

### 平板适配
- 文件树可折叠，默认关闭
- 工具栏按钮精简，部分移入菜单
- 终端面板默认隐藏
- 支持手势操作 (触摸屏)

### 移动端适配
- 全屏编辑器模式
- 底部导航栏 (汉堡菜单 + 主要操作)
- 使用原生文件 API (iOS/Android)
- 禁用自动补全 (默认)
- 优化软键盘交互

---

## ♿ 无障碍设计

### 键盘导航
- 完整的 Tab 键导航支持
- 焦点指示器清晰可见
- 快捷键可自定义

### 屏幕阅读器支持
- 语义化 HTML 结构
- 提供状态标签 (ARIA attributes)
- 代码阅读模式 (逐词/逐行)

### 色盲友好
- 避免仅用颜色区分状态的 UI
- 使用图标 + 文字双重提示
- 提供高对比度模式

### 字体大小调整
- 编辑器字体: 12px - 24px (可调)
- 行高: 1.5 - 2.0 (可调)
- UI 字体: 系统默认，支持缩放

---

## 🔧 滚动条设计

### 编辑器滚动条

**垂直滚动条:**
```css
宽度: 14px
背景: rgba(255, 255, 255, 0.05)
滑块: rgba(255, 255, 255, 0.2)
滑块悬停: rgba(255, 255, 255, 0.35)
激活: rgba(255, 255, 255, 0.4)
```

**水平滚动条:**
```css
高度: 14px
样式: 同垂直滚动条
```

**滚动行为:**
- 平滑滚动
- 滚轮速度: 正常
- Trackpad 支持

---

## 📊 设计验证

### 可用性测试目标
- 新用户 5 分钟内能找到并使用所有核心功能
- 保存操作成功率 > 95%
- 自动补全满意度 > 80%

### 性能指标
- 编辑器初始化 < 300ms
- 语法高亮延迟 < 50ms
- 自动补全触发 < 100ms
- 保存操作 < 200ms

---

## 📸 设计资源

### 图标资源
- **图标库:** Lucide Icons / vs-code-icons
- **尺寸:** 16×16px, 24×24px, 32×32px
- **格式:** SVG

### 字体资源
- **等宽字体:** Fira Code (推荐), JetBrains Mono, Consolas
- **UI 字体:** Inter, SF Pro, Segoe UI

### 颜色变量
```css
:root {
  /* One Dark Theme */
  --editor-bg: #1e1e1e;
  --editor-fg: #abb2bf;
  --editor-line-num-bg: #1e1e1e;
  --editor-line-num-fg: #4b5263;
  --editor-selection-bg: #264f78;
  --editor-cursor-bg: #aeafad;
  --editor-activity-line-bg: #2c313c;

  /* 语法高亮 */
  --syntax-keyword: #c678dd;
  --syntax-string: #98c379;
  --syntax-number: #d19a66;
  --syntax-comment: #5c6370;
  --syntax-function: #61afef;
  --syntax-variable: #e06c75;
  --syntax-operator: #56b6c2;

  /* UI 颜色 */
  --ui-primary: #007acc;
  --ui-border: #454545;
  --ui-hover: rgba(255, 255, 255, 0.1);
}
```

---

## 📝 实现要点

### CodeMirror 6 配置要点
1. **语言包:** 使用 `@codemirror/language` 支持多语言
2. **自动补全:** 配置 `autocompletion` 扩展
3. **主题:** 自定义 One Dark 主题
4. **行号:** 启用 `lineNumbers` 扩展
5. **代码折叠:** 配置 `foldGutter` 扩展
6. **多光标:** 启用 `multipleSelections` 扩展

### React 组件结构
```tsx
<EditorLayout>
  <FileTreePanel />
  <EditorPanel>
    <EditorToolbar />
    <EditorTabs />
    <CodeMirrorEditor />
    <EditorFooter />
  </EditorPanel>
  <TerminalPanel />
  <StatusBar />
</EditorLayout>
```

### 状态管理
- **编辑器状态:** zustand store
- **文件列表:**zustand store
- **用户偏好:** localStorage

---

## ✅ 验收清单

### 功能验收
- [ ] 20+ 语言语法高亮正常工作
- [ ] 自动补全流畅响应
- [ ] 文件保存/另存为功能正常
- [ ] 标签页切换和管理正常
- [ ] 多光标编辑功能正常
- [ ] 代码折叠功能正常

### 视觉验收
- [ ] One Dark 主题配色正确
- [ ] 行号显示准确美观
- [ ] 自动补全弹窗样式符合设计
- [ ] 操作反馈清晰可见
- [ ] 工具栏布局合理

### 性能验收
- [ ] 编辑器加载时间 < 300ms
- [ ] 语法高亮延迟 < 50ms
- [ ] 自动补全触发 < 100ms
- [ ] 大文件 (>100KB) 渲染流畅

### 无障碍验收
- [ ] 键盘导航完整支持
- [ ] 屏幕阅读器兼容
- [ ] 高对比度模式可用
- [ ] 字体大小可调整

---

## 🔄 后续优化方向

### Phase 2 (Sprint 2)
- 添加更多主题（GitHub Dark, Nord, Dracula）
- 自定义高亮配置
- 智能代码格式化预览
- Git diff 集成

### Phase 3 (Sprint 3+)
-协同编辑功能
- AI 代码补全优化
- 代码片段管理
- 重构预览

---

**设计完成时间:** 2025-02-02
**设计师签名:** Product Designer (Subagent)
**审核状态:** 👁 待审核
